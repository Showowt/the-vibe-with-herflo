<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>The Vibe Check Admin | Applications Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;500;600;700;800&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        :root{--gold:#D4AF37;--gold-light:#F4E4BC;--crimson:#8B0000;--black:#0A0A0A;--black-rich:#121212;--black-card:#1a1a1a;--white:#FAFAFA;--gray:#888;--green:#27ae60;--red:#e74c3c;--blue:#3498db;--gradient-gold:linear-gradient(135deg,#D4AF37 0%,#F4E4BC 50%,#D4AF37 100%)}*{margin:0;padding:0;box-sizing:border-box}body{font-family:'DM Sans',sans-serif;background:var(--black);color:var(--white);min-height:100vh}.sidebar{position:fixed;left:0;top:0;bottom:0;width:260px;background:var(--black-rich);border-right:1px solid rgba(212,175,55,0.1);padding:2rem;display:flex;flex-direction:column}.logo{font-family:'Syne',sans-serif;font-size:1.5rem;font-weight:800;background:var(--gradient-gold);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:0.5rem}.logo-sub{font-size:0.75rem;color:var(--gray);letter-spacing:0.1em;text-transform:uppercase;margin-bottom:3rem}.nav-menu{list-style:none;flex:1}.nav-menu li{margin-bottom:0.5rem}.nav-menu a{display:flex;align-items:center;gap:0.75rem;padding:0.875rem 1rem;color:var(--gray);text-decoration:none;border-radius:8px;transition:all 0.3s}.nav-menu a:hover,.nav-menu a.active{background:rgba(212,175,55,0.1);color:var(--gold)}.nav-menu a.active{border-left:3px solid var(--gold)}.main-content{margin-left:260px;padding:2rem 3rem}.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem}.header h1{font-family:'Syne',sans-serif;font-size:2rem;font-weight:700}.header-actions{display:flex;gap:1rem}.btn{padding:0.75rem 1.5rem;font-family:'Syne',sans-serif;font-size:0.85rem;font-weight:600;border:none;cursor:pointer;transition:all 0.3s;text-decoration:none;display:inline-flex;align-items:center;gap:0.5rem;border-radius:6px}.btn-primary{background:var(--gradient-gold);color:var(--black)}.btn-primary:hover{transform:translateY(-2px);box-shadow:0 10px 30px rgba(212,175,55,0.3)}.btn-secondary{background:transparent;color:var(--gold);border:1px solid var(--gold)}.btn-secondary:hover{background:var(--gold);color:var(--black)}.stats-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:1.5rem;margin-bottom:2rem}.stat-card{background:var(--black-card);border:1px solid rgba(212,175,55,0.1);padding:1.5rem;border-radius:12px}.stat-card h3{font-size:0.8rem;color:var(--gray);text-transform:uppercase;letter-spacing:0.1em;margin-bottom:0.5rem}.stat-card .number{font-family:'Syne',sans-serif;font-size:2.5rem;font-weight:800;background:var(--gradient-gold);-webkit-background-clip:text;-webkit-text-fill-color:transparent}.stat-card.green .number{-webkit-text-fill-color:var(--green)}.stat-card.blue .number{-webkit-text-fill-color:var(--blue)}.filters{display:flex;gap:1rem;margin-bottom:1.5rem;flex-wrap:wrap}.filter-group{display:flex;align-items:center;gap:0.5rem}.filter-group label{font-size:0.85rem;color:var(--gray)}.filter-group select,.filter-group input{padding:0.625rem 1rem;background:var(--black-card);border:1px solid rgba(212,175,55,0.2);color:var(--white);font-size:0.9rem;border-radius:6px}.filter-group select:focus,.filter-group input:focus{outline:none;border-color:var(--gold)}.search-box{flex:1;max-width:300px}.search-box input{width:100%}.table-container{background:var(--black-card);border:1px solid rgba(212,175,55,0.1);border-radius:12px;overflow:hidden}table{width:100%;border-collapse:collapse}th,td{padding:1rem 1.25rem;text-align:left;border-bottom:1px solid rgba(255,255,255,0.05)}th{background:rgba(212,175,55,0.05);font-family:'Syne',sans-serif;font-size:0.75rem;font-weight:600;text-transform:uppercase;letter-spacing:0.1em;color:var(--gold)}tr:hover{background:rgba(212,175,55,0.03)}td{font-size:0.9rem}.applicant-name{font-weight:500}.applicant-email{color:var(--gray);font-size:0.85rem}.badge{display:inline-block;padding:0.35rem 0.75rem;font-size:0.75rem;font-weight:600;border-radius:20px;text-transform:uppercase;letter-spacing:0.05em}.badge-pending{background:rgba(241,196,15,0.2);color:#f1c40f}.badge-reviewed{background:rgba(52,152,219,0.2);color:#3498db}.badge-selected{background:rgba(39,174,96,0.2);color:#27ae60}.badge-rejected{background:rgba(231,76,60,0.2);color:#e74c3c}.badge-waitlist{background:rgba(155,89,182,0.2);color:#9b59b6}.badge-paid{background:rgba(39,174,96,0.2);color:#27ae60}.badge-unpaid{background:rgba(231,76,60,0.2);color:#e74c3c}.actions{display:flex;gap:0.5rem}.action-btn{width:32px;height:32px;display:flex;align-items:center;justify-content:center;background:transparent;border:1px solid rgba(212,175,55,0.2);color:var(--gray);cursor:pointer;border-radius:6px;transition:all 0.3s;font-size:0.9rem}.action-btn:hover{border-color:var(--gold);color:var(--gold)}.modal-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.85);display:flex;align-items:center;justify-content:center;z-index:1000;opacity:0;visibility:hidden;transition:all 0.3s}.modal-overlay.active{opacity:1;visibility:visible}.modal{background:var(--black-rich);border:1px solid rgba(212,175,55,0.2);border-radius:12px;width:90%;max-width:700px;max-height:90vh;overflow-y:auto;transform:scale(0.95);transition:transform 0.3s}.modal-overlay.active .modal{transform:scale(1)}.modal-header{padding:1.5rem 2rem;border-bottom:1px solid rgba(212,175,55,0.1);display:flex;justify-content:space-between;align-items:center}.modal-header h2{font-family:'Syne',sans-serif;font-size:1.5rem}.modal-close{width:36px;height:36px;display:flex;align-items:center;justify-content:center;background:transparent;border:1px solid rgba(212,175,55,0.2);color:var(--gray);cursor:pointer;border-radius:6px;font-size:1.2rem}.modal-close:hover{border-color:var(--gold);color:var(--gold)}.modal-body{padding:2rem}.detail-grid{display:grid;grid-template-columns:1fr 1fr;gap:1.5rem}.detail-item{margin-bottom:1rem}.detail-item.full-width{grid-column:span 2}.detail-label{font-size:0.75rem;color:var(--gold);text-transform:uppercase;letter-spacing:0.1em;margin-bottom:0.35rem}.detail-value{font-size:1rem;color:var(--white)}.detail-value.text-block{background:rgba(255,255,255,0.03);padding:1rem;border-radius:8px;white-space:pre-wrap;line-height:1.6}.modal-footer{padding:1.5rem 2rem;border-top:1px solid rgba(212,175,55,0.1);display:flex;gap:1rem;justify-content:flex-end}.status-select{padding:0.5rem 1rem;background:var(--black-card);border:1px solid rgba(212,175,55,0.2);color:var(--white);border-radius:6px;font-size:0.9rem}.loading{text-align:center;padding:4rem;color:var(--gray)}.loading-spinner{width:40px;height:40px;border:3px solid rgba(212,175,55,0.2);border-top-color:var(--gold);border-radius:50%;animation:spin 1s linear infinite;margin:0 auto 1rem}@keyframes spin{to{transform:rotate(360deg)}}.empty-state{text-align:center;padding:4rem;color:var(--gray)}.empty-state h3{font-family:'Syne',sans-serif;font-size:1.5rem;margin-bottom:0.5rem;color:var(--white)}@media(max-width:1200px){.stats-grid{grid-template-columns:repeat(2,1fr)}}@media(max-width:900px){.sidebar{display:none}.main-content{margin-left:0}.detail-grid{grid-template-columns:1fr}.detail-item.full-width{grid-column:span 1}}@media(max-width:600px){.stats-grid{grid-template-columns:1fr}.filters{flex-direction:column}.search-box{max-width:none}.table-container{overflow-x:auto}table{min-width:800px}}
    </style>
</head>
<body>
    <aside class="sidebar">
        <img src="logo.png" alt="The Vibe Check" style="height:50px;margin-bottom:1rem">
        <div class="logo-sub">Admin Dashboard</div>
        <ul class="nav-menu">
            <li><a href="#" class="active">üìã Applications</a></li>
            <li><a href="#">üìä Analytics</a></li>
            <li><a href="#">üí∞ Payments</a></li>
            <li><a href="#">‚öôÔ∏è Settings</a></li>
        </ul>
        <button class="btn btn-secondary" id="logoutBtn" style="margin-top:auto;margin-bottom:1rem;width:100%">üö™ Logout</button>
        <a href="/" class="btn btn-secondary" style="width:100%;text-align:center">‚Üê Back to Site</a>
    </aside>

    <main class="main-content">
        <div class="header">
            <h1>Applications</h1>
            <div class="header-actions">
                <button class="btn btn-secondary" id="exportBtn">üì• Export CSV</button>
                <button class="btn btn-primary" id="refreshBtn">üîÑ Refresh</button>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card"><h3>Total Applications</h3><div class="number" id="totalCount">0</div></div>
            <div class="stat-card green"><h3>Selected</h3><div class="number" id="selectedCount">0</div></div>
            <div class="stat-card blue"><h3>Pending Review</h3><div class="number" id="pendingCount">0</div></div>
            <div class="stat-card"><h3>Paid</h3><div class="number" id="paidCount">0</div></div>
        </div>

        <div class="filters">
            <div class="search-box"><input type="text" id="searchInput" placeholder="üîç Search by name or email..."></div>
            <div class="filter-group"><label>Status:</label><select id="statusFilter"><option value="">All</option><option value="pending">Pending</option><option value="reviewed">Reviewed</option><option value="selected">Selected</option><option value="rejected">Rejected</option><option value="waitlist">Waitlist</option></select></div>
            <div class="filter-group"><label>Payment:</label><select id="paymentFilter"><option value="">All</option><option value="paid">Paid</option><option value="unpaid">Unpaid</option></select></div>
            <div class="filter-group"><label>Gender:</label><select id="genderFilter"><option value="">All</option><option value="woman">Woman</option><option value="man">Man</option><option value="non-binary">Non-Binary</option></select></div>
        </div>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Applicant</th>
                        <th>Age</th>
                        <th>Gender</th>
                        <th>Seeking</th>
                        <th>Location</th>
                        <th>Status</th>
                        <th>Payment</th>
                        <th>Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="applicationsTable">
                    <tr><td colspan="9" class="loading"><div class="loading-spinner"></div>Loading applications...</td></tr>
                </tbody>
            </table>
        </div>
    </main>

    <div class="modal-overlay" id="detailModal">
        <div class="modal">
            <div class="modal-header">
                <h2>Application Details</h2>
                <button class="modal-close" id="modalCloseBtn">√ó</button>
            </div>
            <div class="modal-body" id="modalBody"></div>
            <div class="modal-footer">
                <select class="status-select" id="statusSelect">
                    <option value="pending">Pending</option>
                    <option value="reviewed">Reviewed</option>
                    <option value="selected">Selected</option>
                    <option value="rejected">Rejected</option>
                    <option value="waitlist">Waitlist</option>
                </select>
                <button class="btn btn-secondary" id="modalCancelBtn">Close</button>
                <button class="btn btn-primary" id="updateStatusBtn">Update Status</button>
                <button class="btn btn-primary" id="sendPaymentBtn" style="background:linear-gradient(135deg,#27ae60,#2ecc71)">üí∞ Send Payment Link</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';

        const supabaseUrl = 'https://slitfgfhbmvjhaxjxyfz.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNsaXRmZ2ZoYm12amhheGp4eWZ6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk4ODM2ODEsImV4cCI6MjA4NTQ1OTY4MX0.BmNKWDsQ324HkFunYrc8bfT8pNyxNABw_aHtlVQ6Rdo';
        const supabase = createClient(supabaseUrl, supabaseKey);

        // Authentication check - redirect to login if not authenticated
        const { data: { session } } = await supabase.auth.getSession();
        if (!session) {
            window.location.href = '/login.html';
        }

        // Logout handler
        document.getElementById('logoutBtn').addEventListener('click', async () => {
            await supabase.auth.signOut();
            window.location.href = '/login.html';
        });

        let allApplications = [];
        let currentApplication = null;

        // DOM elements
        const tbody = document.getElementById('applicationsTable');
        const searchInput = document.getElementById('searchInput');
        const statusFilter = document.getElementById('statusFilter');
        const paymentFilter = document.getElementById('paymentFilter');
        const genderFilter = document.getElementById('genderFilter');
        const detailModal = document.getElementById('detailModal');
        const modalBody = document.getElementById('modalBody');
        const statusSelect = document.getElementById('statusSelect');

        // Load applications
        async function loadApplications() {
            tbody.innerHTML = '<tr><td colspan="9" class="loading"><div class="loading-spinner"></div>Loading applications...</td></tr>';

            try {
                const { data, error } = await supabase
                    .from('applications')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) throw error;

                allApplications = data || [];
                updateStats();
                renderTable(allApplications);

            } catch (error) {
                console.error('Error loading applications:', error);
                tbody.innerHTML = `<tr><td colspan="9" class="empty-state"><h3>Error loading data</h3><p>${error.message}</p></td></tr>`;
            }
        }

        function updateStats() {
            document.getElementById('totalCount').textContent = allApplications.length;
            document.getElementById('selectedCount').textContent = allApplications.filter(a => a.status === 'selected').length;
            document.getElementById('pendingCount').textContent = allApplications.filter(a => a.status === 'pending').length;
            document.getElementById('paidCount').textContent = allApplications.filter(a => a.payment_status === 'paid').length;
        }

        function renderTable(applications) {
            if (applications.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" class="empty-state"><h3>No applications found</h3><p>Applications will appear here once submitted.</p></td></tr>';
                return;
            }

            tbody.innerHTML = applications.map(app => `
                <tr data-id="${app.id}">
                    <td>
                        <div class="applicant-name">${app.first_name} ${app.last_name}</div>
                        <div class="applicant-email">${app.email}</div>
                    </td>
                    <td>${app.age}</td>
                    <td>${capitalize(app.gender)}</td>
                    <td>${capitalize(app.seeking)}</td>
                    <td>${app.state}, ${app.country}</td>
                    <td><span class="badge badge-${app.status}">${app.status}</span></td>
                    <td><span class="badge badge-${app.payment_status}">${app.payment_status}</span></td>
                    <td>${formatDate(app.created_at)}</td>
                    <td>
                        <div class="actions">
                            <button class="action-btn view-btn" data-id="${app.id}" title="View Details">üëÅ</button>
                            <button class="action-btn copy-btn" data-email="${app.email}" title="Copy Email">üìß</button>
                        </div>
                    </td>
                </tr>
            `).join('');

            // Add event listeners
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.addEventListener('click', () => viewApplication(btn.dataset.id));
            });
            document.querySelectorAll('.copy-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    navigator.clipboard.writeText(btn.dataset.email);
                    alert('Email copied: ' + btn.dataset.email);
                });
            });
        }

        function filterApplications() {
            const search = searchInput.value.toLowerCase();
            const status = statusFilter.value;
            const payment = paymentFilter.value;
            const gender = genderFilter.value;

            const filtered = allApplications.filter(app => {
                const matchSearch = !search || 
                    app.first_name.toLowerCase().includes(search) ||
                    app.last_name.toLowerCase().includes(search) ||
                    app.email.toLowerCase().includes(search);
                const matchStatus = !status || app.status === status;
                const matchPayment = !payment || app.payment_status === payment;
                const matchGender = !gender || app.gender === gender;
                return matchSearch && matchStatus && matchPayment && matchGender;
            });

            renderTable(filtered);
        }

        function viewApplication(id) {
            currentApplication = allApplications.find(a => a.id === id);
            if (!currentApplication) return;

            statusSelect.value = currentApplication.status;

            modalBody.innerHTML = `
                <div class="detail-grid">
                    <div class="detail-item"><div class="detail-label">Full Name</div><div class="detail-value">${currentApplication.first_name} ${currentApplication.last_name}</div></div>
                    <div class="detail-item"><div class="detail-label">Email</div><div class="detail-value">${currentApplication.email}</div></div>
                    <div class="detail-item"><div class="detail-label">Phone</div><div class="detail-value">${currentApplication.phone}</div></div>
                    <div class="detail-item"><div class="detail-label">Age</div><div class="detail-value">${currentApplication.age}</div></div>
                    <div class="detail-item"><div class="detail-label">Gender</div><div class="detail-value">${capitalize(currentApplication.gender)}</div></div>
                    <div class="detail-item"><div class="detail-label">Seeking</div><div class="detail-value">${capitalize(currentApplication.seeking)}</div></div>
                    <div class="detail-item"><div class="detail-label">Country</div><div class="detail-value">${currentApplication.country}</div></div>
                    <div class="detail-item"><div class="detail-label">State/Region</div><div class="detail-value">${currentApplication.state}</div></div>
                    <div class="detail-item full-width"><div class="detail-label">Energy Description</div><div class="detail-value text-block">${currentApplication.energy_description || 'Not provided'}</div></div>
                    <div class="detail-item full-width"><div class="detail-label">Why Vibe Check?</div><div class="detail-value text-block">${currentApplication.why_vibe_check || 'Not provided'}</div></div>
                    <div class="detail-item"><div class="detail-label">Applied On</div><div class="detail-value">${formatDateFull(currentApplication.created_at)}</div></div>
                    <div class="detail-item"><div class="detail-label">Application ID</div><div class="detail-value" style="font-size:0.8rem;color:var(--gray)">${currentApplication.id}</div></div>
                </div>
            `;

            detailModal.classList.add('active');
        }

        async function updateStatus() {
            if (!currentApplication) return;

            const newStatus = statusSelect.value;

            try {
                const { error } = await supabase
                    .from('applications')
                    .update({ status: newStatus })
                    .eq('id', currentApplication.id);

                if (error) throw error;

                currentApplication.status = newStatus;
                updateStats();
                filterApplications();
                closeModal();
                alert('Status updated successfully!');

            } catch (error) {
                console.error('Error updating status:', error);
                alert('Error updating status: ' + error.message);
            }
        }

        function closeModal() {
            detailModal.classList.remove('active');
            currentApplication = null;
        }

        function exportCSV() {
            if (allApplications.length === 0) {
                alert('No applications to export');
                return;
            }

            const headers = ['First Name','Last Name','Email','Phone','Age','Gender','Seeking','Country','State','Energy Description','Why Vibe Check','Status','Payment','Applied'];
            const rows = allApplications.map(app => [
                app.first_name, app.last_name, app.email, app.phone, app.age, app.gender, app.seeking, app.country, app.state,
                (app.energy_description || '').replace(/"/g, '""'),
                (app.why_vibe_check || '').replace(/"/g, '""'),
                app.status, app.payment_status, formatDate(app.created_at)
            ]);

            const csv = [headers, ...rows].map(row => row.map(cell => `"${cell}"`).join(',')).join('\n');
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `vibe-check-applications-${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
        }

        // Helpers
        function capitalize(str) {
            return str ? str.charAt(0).toUpperCase() + str.slice(1) : '';
        }

        function formatDate(d) {
            return d ? new Date(d).toLocaleDateString('en-US', { month: 'short', day: 'numeric' }) : '-';
        }

        function formatDateFull(d) {
            return d ? new Date(d).toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' }) : '-';
        }

        // Event listeners
        document.getElementById('refreshBtn').addEventListener('click', loadApplications);
        document.getElementById('exportBtn').addEventListener('click', exportCSV);
        document.getElementById('modalCloseBtn').addEventListener('click', closeModal);
        document.getElementById('modalCancelBtn').addEventListener('click', closeModal);
        document.getElementById('updateStatusBtn').addEventListener('click', updateStatus);
        
        // Send Payment Link
        document.getElementById('sendPaymentBtn').addEventListener('click', () => {
            if (!currentApplication) return;
            
            const name = `${currentApplication.first_name} ${currentApplication.last_name}`;
            const email = currentApplication.email;
            const paymentLink = 'https://cash.app/$theflo702/15';
            
            const subject = encodeURIComponent('The Vibe Check - You\'ve Been Selected! üéâ');
            const body = encodeURIComponent(`Hi ${currentApplication.first_name},

Congratulations! You've been selected to participate in The Vibe Check Dating Show with HerFlo!

To confirm your spot, please complete your $15 application fee using the link below:

${paymentLink}

After payment, reply to this email with your Cash App confirmation so we can finalize your spot.

We're excited to have you on the show!

- The Vibe Check Team
HOT 702.5 FM Risky Radio`);
            
            window.open(`mailto:${email}?subject=${subject}&body=${body}`, '_blank');
        });
        searchInput.addEventListener('keyup', filterApplications);
        statusFilter.addEventListener('change', filterApplications);
        paymentFilter.addEventListener('change', filterApplications);
        genderFilter.addEventListener('change', filterApplications);
        detailModal.addEventListener('click', (e) => { if (e.target === detailModal) closeModal(); });
        document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeModal(); });

        // Initialize
        loadApplications();
    </script>
</body>
</html>
